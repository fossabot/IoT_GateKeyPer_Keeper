### 개발 진행 상황
 - [x] 테스트 베드 구성 완료 (1. tinkercad, 2. 오프라인 환경)
 - [x] I2C 송수신 프레임 구성 완료 - tinkercad 테스트 완료
 - [x] Key/Lock 펌웨어 개발 (초안)
 - [ ] Cradle 펌웨어 개발 (초안)
 - [ ] 오프라인 환경 테스트 진행
 - [ ] 온라인 제어 환경 구축 (Python)
 - [ ] UX/UI 개선 (Django)
 - [ ] 전체 구동 후 피드백

---------

### 키-자물쇠 기능에 대한 사용 흐름과 UI

#

#### A. 키의 배터리 기능 구현 : 테스트베드에서는 미구축

- 배터리가 적으면 LED가 적색으로 깜빡거림 (켜짐 꺼짐 1:5 비율)
- 배터리 단자 연결 시 녹색으로 깜빡거림 (충전중임을 알 수 있도록)
- 배터리 완충 시 녹색으로 점등 (완충됨을 알 수 있도록)
- 충전 잭 분리 시 기본적으로 LED 점등이 되지 않음
- 버튼을 클릭하면 배터리 상황 3초간 도시 (50-100% : 녹색, 30-50% : 주황, 10-30% 적색)

#

#### B. 키와 자물쇠간 통신 시나리오

1. 키를 자물쇠에 꽂음

   1. 키가 자물쇠와 연결되면

      - (전원이 들어오면) 키는 LED 적색으로 점등
      - **다음단계 진입**

   2. 키가 비정상적으로 연결되면
      - 사용자가 물리적으로 뺌
      - **"1." 항목으로 이동**

2. 자물쇠와 통신이 원활한지 확인
   ```
   [통신 조건]
    * 조건 1. 키에서 자물쇠로 패킷이 원활하게 보내져야 함
    * 조건 2. 자물쇠에서 수신 후, 키로 자물쇠의 ID가 담긴 패킷이 원활하게 보내져야 함
    * 조건 3. 키에서 자물쇠 패킷이 원활히 받아져야 함
   ```
   1. 통신이 원활할 경우
      - 자물쇠의 LED가 적색으로 점등
      - **다음단계 진입**
   2. 통신이 원활하지 않을 경우
      - 자물쇠 또는 키의 LED가 적색으로 깜빡임.
      - 비프음으로 잘못되었음을 안내(경고음 : 도-도)
      - **"1." 항목으로 이동**
      #
   ```
   [에러 상황 예시]
    * 에러 1. 물리적 조건으로 접촉 불량 의심. 자물쇠를 빼고 재시도
    * 에러 2. I2C 통신 시, 데이터 오류 의심. 원인에 따라 대응 필요(아마 내부적인 디버깅이 필요 -> 생기면 안되는 현상)
   ```
3. 키의 부저로 비프음을 울리고(켜지는 비프음 : 도-솔), 키의 LED를 파란색으로 점등, 지문 스캐닝 5초간 진행

   1. 지문이 정상일 경우,
      1. 자물쇠와 통신상태 재확인하여 양호 한 경우
         - 현재 스캔이 된 지문과 키의 ID, 시간데이터를 자물쇠에 패킷 송신.
         - 자물쇠에서 패킷을 받아 자물쇠의 EEPROM에 기입
         - 현재 시각, 자물쇠의 ID, 지문을 키의 EEPROM에 기입
         - **다음단계 진입**
      2. 자물쇠와 통신 두절시
         - **"2." 항목 재시작** (이미 완전 단락되었을 가능성이 높으므로, 사실상 "1." 항목으로 이동.
   2. 지문이 비정상일 경우
      - (지문의 형태가 아닐경우 지문센서 모듈단위에서 감지함)
      - 비프음으로 잘못되었음을 안내(경고음 : 도-도)
      - **"3." 항목 재시작**

4. 0.5초 뒤, 자물쇠 해지 디스플레이(실제로는 이미 3.의 단계에서 해지가 되었으나, 그전에 키를 떼지 않도록 이후에 UI/UX차원으로 후속 도시)
   - 키의 부저로 비프음을 울림(인식이 된 비프음 : 도-미-솔)
   - 키의 LED를 초록으로 점등
   - 자물쇠의 LED를 초록으로 점등
   - 자물쇠의 Lock 해지

#

#### C. 키와 자물쇠의 권한 설정

1. 키 또는 자물쇠를 크래들에 연결한다.
2. 하기의 명령어를 참조하여 정보 확인 및 세팅을 진행한다.

   - PC상의 아두이노 Serial을 통해, 현재 연결된 키의 정보확인 가능.(현재는 아두이노 Serial로 확인하나, 타 방식으로 변경 가능. Mobile 또는 NFC 등등)

   | Serial Input     | 사용 상황                 | Output(Return)                                                                                                            |
   | ---------------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
   | Key_info         | 연결된 키의 정보 확인     | - 키 생성일시<br> - 생성 지문<br> - 현재 키의 ID와 보안 등급<br> - 배터리 수준(0~100%<br> - 메모리 용량(확인 가능할 경우) |
   | Key_log          | 연결된 키의 로그 확인     | - 현재 키의 ID와 보안 등급<br> 1. 연결한 Lock의 ID ㅣ 연결되었던 시간 ㅣ 열었던 지문<br> 2. .... <br> 3. ....             |
   | **Key_setting**  | 연결된 키의 정보 세팅     | - 구성중                                                                                                                  |
   | Lock_info        | 연결된 자물쇠의 정보 확인 | - Lock 생성일시<br> - 생성 지문<br> - 현재 Lock ID<br> - 메모리 용량(확인 가능할 경우)                                    |
   | Lock_log         | 연결된 자물쇠의 로그 확인 | - 현재 Lock의 ID<br> 1. 연결한 Key의 ID ㅣ 연결되었던 시간 ㅣ 열었던 지문<br> 2. .... <br> 3. ....                        |
   | **Lock_setting** | 연결된 자물쇠 정보 세팅   | - 구성중                                                                                                                  |

   **Setting 기능의 경우**

   - 중복되는 ID가 없어야 함 (크래들용 MCU에 기존 DB가 축적되어, 신규인지 중복인지 비교 필요)
   - 관리자의 지문이 필요함
   - 정규식을 준수해야 함 (비정상적인 데이터이면, 세팅 불가)

#

#### D. 크래들의 권한 설정

: 작성중
